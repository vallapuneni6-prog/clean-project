RewriteEngine On
RewriteBase /

# Preserve Authorization header
SetEnvIf Authorization ^(.*)$ HTTP_AUTHORIZATION=$1
RewriteCond %{HTTP:Authorization} ^(.+)$
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

# Force HTTPS
RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301,NE]

# CRITICAL: Don't rewrite /api requests - must be FIRST
RewriteRule ^api(/|$) - [L]

# Don't rewrite /dist requests
RewriteRule ^dist(/|$) - [L]

# Allow real files (skip rewriting)
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Allow real directories (skip rewriting)
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# SPA routing: rewrite everything else to dist/index.html
RewriteRule ^(.*)$ dist/index.html [QSA,L]

# Disable directory listing
Options -Indexes
