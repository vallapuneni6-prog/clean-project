RewriteEngine On
RewriteBase /

# Preserve Authorization header
SetEnvIf Authorization ^(.*)$ HTTP_AUTHORIZATION=$1

# Force HTTPS
RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301,NE]

# API routing: map /api/endpoint to /api/endpoint.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^api/(.+)$ api/$1.php [QSA,L]

# After API routing, don't rewrite further /api requests
RewriteRule ^api/ - [L]

# Don't rewrite real files
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Don't rewrite real directories
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# SPA routing: everything else goes to index.html
RewriteRule .* /index.html [QSA,L]

Options -Indexes
